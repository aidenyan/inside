<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>开票资料</title>
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <link rel="stylesheet" href="../../common/css/common.css">
    <link rel="stylesheet" href="../../common/css/font-style.css">
</head>
<body>
<div class="content-wrpper">
    <div class="list">
        <!-- header  搜索条件-->
        <div class="content-search layui-form">
            <div class=" layui-form-item">
                <div class="layui-inline">
                    <a href="javascript:;" id="invoiceAdd" class="layui-btn layui-btn-small"> <i class="layui-icon"style="vertical-align: middle">
                        &#xe61f;</i>新增开票</a>
                </div>

                <div class="layui-inline">
                    <select name="" id="taxpayerType">
                        <option value="">选择纳税人类型</option>
                        <option value="">全部</option>
                        <option value="1">一般纳税人</option>
                        <option value="2">小规模纳税人</option>
                        <option value="3">个人纳税人</option>
                    </select>
                </div>

                <div class="layui-inline">
                    <input id="searchVal" type="text" name="title" lay-verify="required" placeholder="公司名称/纳税人识别号/门店名称/联系人"
                           autocomplete="off" class="layui-input small mizo-srarch-input">
                    <button id="search" class="layui-btn layui-btn-small">搜索</button>
                </div>
            </div>
        </div>

        <!--table 数据-->
        <div class="panel layui-form">
            <!--<table class="layui-table" id="">
                <thead>
                <tr>
                    <th class="min-w40">序号</th>
                    <th class="min-w165">开票公司名称</th>
                    <th class="min-w100">纳税人识别号</th>
                    <th class="min-w120">开户行</th>
                    <th class="min-w150">帐号</th>
                    <th class="min-w60">注册地区</th>
                    <th class="min-w100">注册电话</th>
                    <th class="min-w100">详细地址</th>
                    <th class="min-w100">纳税人类型</th>
                    <th class="min-w100">备注</th>
                    <th class="min-w50">状态</th>
                    <th class="min-w150">操作</th>
                </tr>
                </thead>
                <tbody id="pager">

                </tbody>
            </table>-->
            <div class="datagrid-header" style="width: 100%; height: 29px;">
                <div class="datagrid-header-inner" style="display: block;position: absolute;left: 0;">
                    <table class="datagrid-htable" cellspacing="0" cellpadding="0" border="0">
                        <tbody>
                        <tr class="datagrid-header-row">
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-number " >序号</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-w200 " >开票公司名称</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-w100 " >纳税人识别号</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-w100 " >门店名称</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-time " >开户行</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-time" >帐号</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-w200" >注册地区</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-w100" >注册电话</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-address2" >详细地址</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-w100">纳税人类型</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-order_num">备注</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-w50">状态</div>
                            </td>
                            <td >
                                <div class="datagrid-cell datagrid-cell-c1-order_num">操作</div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="datagrid-body" style="width: 100%; margin-top: 0px; height: 500px;">
                <table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0">
                    <tbody id="pager"></tbody>
                </table>
            </div>
        </div>
        <div id="pageNum" style="text-align:right"></div>
    </div>
</div>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../common/lib/jquery-1.11.3.min.js"></script>

<script id="pageTpl" type="text/html">
    {{#  layui.each(d.result, function(index, item){ }}
    <tr id="{{item.id}}">
        <input id="invoiceId" type="hidden" value="{{item.id}}">
        <td><div class="datagrid-cell datagrid-cell-c1-number text-c">{{(index+1)+(d.pageSize*(d.pageNo-1))}}</div></td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-w200">
                {{#  if (item.invoiceCompanyName!=null && item.invoiceCompanyName!='') {}}
                {{item.invoiceCompanyName}}
                {{# } else { }}
                -
                {{#}}}
            </div>
        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-w100 break_all">
                {{#  if (item.taxpayerIdentificationNo!=null && item.taxpayerIdentificationNo!='') {}}
                {{item.taxpayerIdentificationNo}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-w100">
                {{#  if (item.storeName!=null && item.storeName!='') {}}
                {{item.storeName}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-time">
                {{#  if (item.openBank!=null && item.openBank!='') {}}
                {{item.openBank}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-time">
                {{#  if (item.account!=null && item.openBank!='') {}}
                {{item.account}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-w200">
                {{#  if (item.registerAddress!=null && item.registerAddress!='') {}}
                {{item.registerAddress}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-w100">
                {{#  if (item.registerTel!=null && item.registerTel!='') {}}
                {{item.registerTel}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-address2 over_hid">
                {{#  if (item.detailAddress!=null && item.detailAddress!='') {}}
                {{item.detailAddress}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-w100 text-c">
                {{#  if (item.taxpayerType==1) {}}
                一般纳税人
                {{# } else if(item.taxpayerType==2) { }}
                小规模纳税人
                {{# } else { }}
                个人纳税人
                {{#}}}
            </div>
        </td>
        <td>
            <div class="datagrid-cell datagrid-cell-c1-order_num break_all">
                {{#  if (item.remark!=null && item.remark!='') {}}
                {{item.remark}}
                {{# } else { }}
                -
                {{#}}}
            </div>

        </td>
       <td>
          <div class="datagrid-cell datagrid-cell-c1-w50 text-c">
              {{#  if (item.state==0) {}}
              未审核
              {{# } else if(item.state==1) { }}
              已审核
              {{# } else {}}
              拒绝
              {{#}}}
          </div>
       </td>
        <td class="state_uhandle">
          <div class="datagrid-cell datagrid-cell-c1-order_num">
            {{# if (item.state==0){}}
            <button class="pass" title="审核通过">
              <i class="icon-zhenque"></i>
            </button>
            <!--
            <button class="refuse" title="审核拒绝">
              <i class="icon-uniE617"></i>
            </button>
            -->
            {{#}}}
            <button class="update" title="编辑">
              <i class="icon-bianji"></i>
            </button>
            {{# if (item.state==0){}}
            <button class="delete" title="删除">
              <i class="icon-delete"></i>
            </button>
            {{#}}}
          </div>
        </td>
    </tr>
    {{#  }); }}

    {{#  if(d.result.length == 0){ }}
    <tr aglin='center'>
        <td colspan='12' style="border-bottom: 0;border-right: 0">
            <div class="null-show"></div>
        </td>
    </tr>
    {{#  } }}
</script>

<script>
     layui.use(['form', 'laypage', 'laydate', 'laytpl', 'myAjax', 'date'], function () {
       var form = layui.form()
       , laypage = layui.laypage
       , layer = layui.layer
       , $ = layui.jquery
       , myAjax = layui.myAjax
       , laytpl = layui.laytpl
       , date = layui.date;
       function pageInvoice(data) {
          if(data==null){
              $('#searchVal').val('');
          }
          myAjax.ajaxPage('/admin/invoice/list.json', 'pageNum', 'pager', 'pageTpl', data);
       }
       pageInvoice();

       //新增
       $("#invoiceAdd").click(function () {
         //callParent.openTab("purchase_add", 0, "新增采购单", "admin/purchase/purchase_add.html", true);
         callParent.openTab("invoice_add", 0, "新增开票资料", "admin/invoice/invoice_add.html", true);
       });

      //审核通过
      $("#pager").on("click", ".pass", function () {
        var invoiceId = $(this).parent().parent().parent().find("#invoiceId")[0].value;
        myAjax.ajaxSend('/admin/invoice/update.json', function () {
            callParent.parentUse("invoice_list", "refresh");
        },  {'id':invoiceId,'state': 1}, 'post');
        callParent.parentUse("invoice_list", "refresh");
      });

      //审核拒绝
      $("#pager").on("click", ".refuse", function () {
        var invoiceId = $(this).parent().parent().parent().find("#invoiceId")[0].value;
        myAjax.ajaxSend('/admin/invoice/update.json', function () {
            callParent.parentUse("invoice_list", "refresh");
        },  {'id':invoiceId,'state': 2}, 'post');
        callParent.parentUse("invoice_list", "refresh");
      });

      //删除开票资料
      $("#pager").on("click", ".delete", function () {
        var invoiceId = $(this).parent().parent().parent().find("#invoiceId")[0].value;
          layer.confirm('确认删除吗?', {icon: 3, title: '提示','closeBtn':0,area: ['430px', '240px']}, function (index) {
              myAjax.ajaxSend('/admin/invoice/update.json', function () {
                  callParent.parentUse("invoice_list", "refresh");
              }, {'id': invoiceId, 'deleted': true}, 'post');
              layer.close(index);
              callParent.parentUse("invoice_list", "refresh");
          });
      });

      //编辑
      $("#pager").on("click", ".update", function () {
        var invoiceId = ($(this).parent().parent().parent().find("#invoiceId")[0]).value;
        callParent.openTab("invoice_add", 0, "编辑开票资料", "admin/invoice/invoice_add.html?invoiceId=" + invoiceId, true);
      });

      //查询
      $("#search").click(function () {
          var searchVal = $.trim($("#searchVal").val());
          var taxpayerType = $("#taxpayerType").val();
          pageInvoice({'invoiceCompanyName':searchVal, 'taxpayerIdentificationNo':searchVal, 'taxpayerType':taxpayerType});
      })

       callParent.isLoadEnd("invoice_list");
       callParent.register(function () {
           pageInvoice();
       }, "refresh");
    });
     /*~function () {
         $(function () {
             resize();
             $(window).resize(function () {
                 resize();
             })
             $('.datagrid-body').scroll(function () {
                 $('.datagrid-header-inner').css('left', -$(this).scrollLeft())
             })
         })
         function resize() {
             var height = $(document.body).height(), topH = 200, panelH = height - topH, bodyH = panelH - 30;
             var width=$('.panel').width(),realW=width - 17;$('.datagrid-htable').css('width',realW);$('.datagrid-btable').css('width',realW);
             $('.panel').css('height', panelH);
             $('.datagrid-body').css('height', bodyH);
         }
     }()*/
</script>
</body>
</html>
